const e=128,t=(()=>{let t=1;for(;Number.isSafeInteger(t*e);)t*=e;return t})();function r(e){if(!Number.isSafeInteger(e)||e<0)throw new TypeError(`invalid uvarint: ${e}`)}function s(t){r(t);let s=1;for(;t>=e;++s)t=Math.floor(t/e);return s}function n(r,s=0){let n=0;for(let a=1;;a*=e){if(s>=r.length)throw new RangeError("buffer overflow");let o=r[s++];if(n+=(127&o)*a,o<e)break;if(a==t)throw new RangeError("uvarint overflow")}return[n,s]}function a(t,s,n=0){for(r(s);!(s<e);)t[n++]=127&s|e,s=Math.floor(s/e);return t[n++]=s,n}var o=Object.freeze({__proto__:null,MAX:t,assert:r,read:n,sizeof:s,write:a});class i{constructor(e){if("string"!=typeof e)throw new TypeError;let t=[...e];if(t.length!==e.length)throw new TypeError;this.chars=e,this.map=new Map(t.map(((e,t)=>[e,t])))}get length(){return this.map.size}parse(e){let t=this.map.get(e);if(!Number.isInteger(t))throw new TypeError(`invalid digit "${e}"`);return t}format(e){return e.map((e=>this.chars[e])).join("")}}class h{constructor(e){if(this.bits=Math.log2(e.length),!Number.isInteger(this.bits))throw new TypeError;this.table=new i(e),this.table.chars+="="}decode(e){let{table:t,bits:r}=this,s=e.length,n=0,a=0,o=0;for(;s&&"="==e[s-1];)--s;let i=new Uint8Array(s*r>>3);for(let h=0;h<s;h++)a=a<<r|t.parse(e[h]),o+=r,o>=8&&(i[n++]=a>>(o-=8)&255);if(a<<8-o&255)throw new Error("invalid");return i}encode(e,t){let{table:r,bits:s}=this,n=(1<<s)-1,a=0,o=0,i=[],h=e.length;for(let t=0;t<h;t++)for(a=a<<8|e[t],o+=8;o>=s;)i.push(a>>(o-=s)&n);for(o&&i.push(a<<s-o&n);t&&i.length*s&7;)i.push(n+1);return r.format(i)}}class c{constructor(e){this.table=new i(e)}decode(e){let{table:t}=this,r=t.length,s=e.length,n=new Uint8Array(s),a=0;for(let s of e){let e=t.parse(s);for(let t=0;t<a;t++)e+=n[t]*r,n[t]=e,e>>=8;for(;e;)n[a++]=e,e>>=8}for(let r=0;r<s&&e[r]===t.chars[0];r++)a++;return n.subarray(0,a).reverse()}encode(e){let{table:t}=this,r=t.length,s=[];for(let t of e){for(let e=0;e<s.length;++e){let n=s[e]<<8|t;s[e]=n%r,t=n/r|0}for(;t;)s.push(t%r),t=t/r|0}for(let t=0;t<e.length&&!e[t];t++)s.push(0);return t.format(s.reverse())}}const l="abcdefghijklmnopqrstuvwxyz",u="0123456789"+l,f=new h(l.toUpperCase()+l+u.slice(0,10)+"+/"),g=new h(l.toUpperCase()+l+u.slice(0,10)+"-_"),p=new c("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),w=new c(u),b=new h(u.slice(0,32)),d=new h("abcdefghijklmnopqrstuvwxyz234567"),m=new h(u.slice(0,16)),y=new c(u.slice(0,10)),v=new h(u.slice(0,8)),E=new h(u.slice(0,2));function x(e,...t){return{decode:r=>e.decode(r,...t),encode:r=>e.encode(r,...t)}}const B={};function U(e,{encode:t,decode:r},s={}){B[e]={prefix:e,encode:t,decode:r,...s}}function C(e,t){if("string"!=typeof e)throw new TypeError("expected string");t||(t=e[0],e=e.slice(1));let r=B[t];if(!r)throw new Error(`unknown multibase: ${t}`);return void 0!==r.casing&&(e=e.toLowerCase()),r.decode(e)}function T(e,t,r=!0){let s=B[e];if(!s)throw new Error(`unknown multibase: ${e}`);let n=s.encode(t);return s.casing&&(n=n.toUpperCase()),r&&(n=s.prefix+n),n}U("0",x(E),{name:"base2"}),U("7",x(v),{name:"base8"}),U("9",x(y),{name:"base10"}),U("f",x(m),{case:!1,name:"base16"}),U("F",x(m),{case:!0,name:"base16upper"}),U("v",x(b),{case:!1,name:"base32hex"}),U("V",x(b),{case:!0,name:"base32hexupper"}),U("t",x(b,!0),{case:!1,name:"base32hexpad"}),U("T",x(b,!0),{case:!0,name:"base32hexpadupper"}),U("b",x(d),{case:!1,name:"base32"}),U("B",x(d),{case:!0,name:"base32upper"}),U("c",x(d,!0),{case:!1,name:"base32pad"}),U("C",x(d,!0),{case:!0,name:"base32padupper"}),U("k",x(w),{case:!1,name:"base36"}),U("K",x(w),{case:!0,name:"base36upper"}),U("z",x(p),{name:"base58btc"}),U("m",x(f),{name:"base64"}),U("M",x(f,!0),{name:"base64pad"}),U("u",x(g),{name:"base64url"}),U("U",x(g,!0),{name:"base64urlpad"}),U("1",x(p),{name:"base58btc-Identity"}),U("Q",x(p),{name:"base58btc-CIDv0"});var I=Object.freeze({__proto__:null,Base10:y,Base16:m,Base2:E,Base32:d,Base32Hex:b,Base36:w,Base58BTC:p,Base64:f,Base64URL:g,Base8:v,MULTIBASES:B,decode:C,encode:T,register:U});class M{static from(e){"string"==typeof e&&(e=C(e));let t,[r,s]=n(e);if([t,s]=n(e,s),(e=new Uint8Array(e.slice(s))).length!==t)throw new Error(`expected ${t}, got ${e.length} bytes`);return new this(r,e)}constructor(e,t){this.code=e,this.hash=t}get length(){return s(this.code)+s(this.hash.length)+this.hash.length}get bytes(){let e=new Uint8Array(this.length);return this.write(e,0),e}write(e,t){return e.set(this.hash,a(e,this.hash.length,a(e,this.code,t))),t}toJSON(){return{...this}}}class S{static from(e){if("string"==typeof e)if(46==e.length&&e.startsWith("Qm"))e=p.decode(e);else if(18==(e=C(e))[0])throw new Error("CIDv0 cannot be multibase");try{if(34==e.length&&18==e[0]&&32==e[1])return new _(M.from(e));let[t,r]=n(e);if(1===t){let t;return[t,r]=n(e,r),new k(t,M.from(e.slice(r)))}throw new Error(`unsupported version: ${t}`)}catch(e){throw console.log(e),new Error(`Malformed CID: ${e.message}`)}}upgrade(){return this}toJSON(){let{version:e,codec:t,hash:r}=this;return{version:e,codec:t,hash:r}}}class _ extends S{constructor(e){super(),this.hash=e}get version(){return 0}get codec(){return 112}get length(){return this.hash.bytes.length}get bytes(){return this.hash.bytes}upgrade(){return new k(this.codec,this.hash)}toString(){return T("Q",this.bytes,!1)}}class k extends S{constructor(e,t){super(),this.codec=e,this.hash=t}get version(){return 1}get length(){return s(this.version)+s(this.codec)+this.hash.length}get bytes(){let e=new Uint8Array(this.length);return this.hash.write(e,a(e,this.codec,a(e,this.version,0))),e}toString(e){return e||(e=114===this.codec?"k":"b"),T(e,this.bytes,!0)}}export{S as CID,_ as CIDv0,k as CIDv1,M as Multihash,c as Prefix0,h as RFC4648,I as multibase,o as uvarint};
